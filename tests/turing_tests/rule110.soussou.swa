khuien:soussou;

// Rule 110: known to be Turing complete.
// Rule 110 transitions:
// 111 -> 0
// 110 -> 1
// 101 -> 1
// 100 -> 0
// 011 -> 1
// 010 -> 1
// 001 -> 1
// 000 -> 0

wali get_next_state(left: konti, mid: konti, right: konti) konti {
    xa (left == 1) {
        xa (mid == 1) {
            xa (right == 1) { gbilen 0; }
            gbilen 1;
        }
        xa (mid == 0) {
            xa (right == 1) { gbilen 1; }
            gbilen 0;
        }
    }
    xa (left == 0) {
        xa (mid == 1) {
            xa (right == 1) { gbilen 1; }
            gbilen 1;
        }
        xa (mid == 0) {
            xa (right == 1) { gbilen 1; }
            gbilen 0;
        }
    }
    gbilen 0;
}

sodé() konti {
    masen("Rule 110 Cellular Automaton (Generation 0-20)\n");
    
    // Tape size 30
    kouicé TAPE_SIZE: konti = 30;
    kouicé tape: [30]konti = [30]konti{}; // Initialize with zeros
    
    // Initial state: 1 at the right end
    tape[29] = 1;
    
    kouicé gen: konti = 0;
    be (gen < 20) {
        // Print current generation
        kouicé p: konti = 0;
        be (p < TAPE_SIZE) {
            xa (tape[p] == 1) {
                masen("#");
            } xamuara {
                masen(".");
            }
            p = p + 1;
        }
        masen("\n");
        
        // Compute next state
        kouicé next_tape: [30]konti = [30]konti{};
        kouicé i: konti = 0;
        be (i < TAPE_SIZE) {
            kouicé left: konti = 0;
            kouicé mid: konti = tape[i];
            kouicé right: konti = 0;
            
            xa (i > 0) { left = tape[i-1]; }
            xa (i < TAPE_SIZE - 1) { right = tape[i+1]; }
            
            next_tape[i] = get_next_state(left, mid, right);
            i = i + 1;
        }
        
        // Update tape
        kouicé u: konti = 0;
        be (u < TAPE_SIZE) {
            tape[u] = next_tape[u];
            u = u + 1;
        }
        
        gen = gen + 1;
    }
    
    gbilen 0;
}
