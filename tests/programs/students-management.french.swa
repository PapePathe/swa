dialecte:franÃ§ais;
// ---------------------------------------------------------
// STRUCT DEFINITIONS
// ---------------------------------------------------------

structure Address {
    StreetNumber: entier,
    StreetName: chaine,
    ZipCode: entier,
}

structure Grades {
    Math: decimal,
    Science: decimal,
    History: decimal,
    Average: decimal,
}

structure Student {
    Id: entier,
    Name: chaine,
    Location: Address,
    Performance: Grades,
    IsActive: entier,
}

structure Classroom {
    RoomNumber: entier,
    Students: [5]Student,
    TotalStudents: entier,
}

// ---------------------------------------------------------
// UTILITY FUNCTIONS
// ---------------------------------------------------------

fonction calculateAverage(m: decimal, s: decimal, h: decimal) decimal {
    // Demonstrates binary expression refactor with decimal promotion
    variable sum: decimal = m + s + h;
    retourner sum / 3.0;
}

fonction printAddress(addr: Address) entier {
    afficher("      Address: %d %s, %d", addr.StreetNumber, addr.StreetName, addr.ZipCode);
    retourner 0;
}

fonction printGrades(g: Grades) entier {
    afficher("      Grades -> M: %.1f, S: %.1f, H: %.1f | AVG: %.2f", g.Math, g.Science, g.History, g.Average);
    retourner 0;
}

// ---------------------------------------------------------
// CORE LOGIC
// ---------------------------------------------------------

fonction initializeStudent(id: entier, name: chaine, streetNum: entier, streetName: chaine, m: decimal, s: decimal, h: decimal) Student {
    // Demonstrates Nested Struct Initialization & Default Values
    variable avg: decimal = calculateAverage(m, s, h);
    
    retourner Student{
        Id: id,
        Name: name,
        Location: Address{
            StreetNumber: streetNum,
            StreetName: streetName,
            ZipCode: 90210
        },
        Performance: Grades{
            Math: m,
            Science: s,
            History: h,
            Average: avg
        },
        IsActive: 1
    };
}

fonction updateStudentPerformance(stud: *Student, m: decimal, s: decimal, h: decimal) entier {
    // Demonstrates Pointer Decay and Member Access via Pointer
    stud.Performance.Math = m;
    stud.Performance.Science = s;
    stud.Performance.History = h;
    stud.Performance.Average = calculateAverage(m, s, h);
    retourner 1;
}

// ---------------------------------------------------------
// MAIN EXECUTION
// ---------------------------------------------------------

demarrer() entier {
    afficher("--- STARTING STUDENT MANAGEMENT SYSTEM ---");

    // 1. Initialize a Classroom (Array of Structs)
    variable myClass: Classroom = Classroom{
        RoomNumber: 101,
        TotalStudents: 0
    };

    // 2. Add Students manually (Demonstrates Struct injection)
    myClass.Students[0] = initializeStudent(1, "Alice Smith", 123, "Maple Ave", 95.5, 88.0, 92.0);
    myClass.Students[1] = initializeStudent(2, "Bob Jones", 456, "Oak St", 70.0, 75.5, 80.0);
    myClass.Students[2] = initializeStudent(3, "Charlie Brown", 789, "Pine Rd", 85.0, 82.0, 88.5);
    myClass.TotalStudents = 3;

    // 3. Update a student using a pointer (Demonstrates injectSymbol and load logic)
    afficher("Updating Charlie's grades...");
    updateStudentPerformance(myClass.Students[2], 90.0, 90.0, 95.0);

    // 4. Iterate and Print using Deep Access (Nested Struct Access)
    afficher("Classroom Report (Room %d):", myClass.RoomNumber);
    
    variable i: entier = 0;
    tantque (i < myClass.TotalStudents) {
        variable s: Student = myClass.Students[i];
        
        afficher("Student ID: %d | Name: %s", s.Id, s.Name);
        
        // Deep Property Access: Student -> Address -> StreetName
        afficher("   Location: %s", myClass.Students[i].Location.StreetName);
        
        // Accessing nested math results
        printGrades(s.Performance);
        
        i = i + 1;
    }

    // 5. Statistics Calculation (Binary Expression Casting)
    variable classSum: decimal = 0.0;
    variable k: entier = 0;
    tantque (k < myClass.TotalStudents) {
        classSum = classSum + myClass.Students[k].Performance.Average;
        k = k + 1;
    }

    // Demonstrating entier/decimal coercion in afficher
    variable classAvg: decimal = classSum / myClass.TotalStudents;
    afficher("---");
    afficher("Class Average Score: %.2f", classAvg);

    // 6. Conditional Logic test
    si (classAvg > 80.0) {
        afficher("Status: Excellence Achievement Unlocked.");
    } sinon {
        afficher("Status: Standard Progress.");
    }

    afficher("--- SYSTEM SHUTDOWN ---");
    retourner 0;
}
